<!DOCTYPE html>
<html>
	<head>
		<title>Séisme</title>
		<link rel="stylesheet" href="/static/style1.css">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

		<!-- Bootstrap script -->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
		
		<!-- Leaflet script -->
		<script src="https://cdn.jsdelivr.net/npm/leaflet@1.4.0/dist/leaflet.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.4.0/dist/leaflet.css"/>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"/>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<style>html, body {width: 99%; height: 88%;}</style>

	</head>



	<body>
		<div id="bg-gradient">
			<h1>Cartographie des séismes en temps réel</h1>
			
			<div id="mapid"></div>
			
			<div class="button1 button-footer">
				<button type="button" class="btn btn-outline-primary btn-lg"><a href="infos.html">Infos</a></button>
				<button type="button" class="btn btn-outline-success btn-lg"><a href="https://earthquake.usgs.gov/">Données</a></button>
				<button type="button" class="btn btn-outline-danger btn-lg">L'équipe</button>
			</div>
	
		</div>
	</body>


	<script>
		//fonction qui retourne la couleur du marqueur en fonction de la puissance du séisme
		function color_marker(magnitude){
			if(magnitude < 2){
				color = 'green';
			}
			else if(magnitude>=2 && magnitude<4){
				color = 'darkgreen';
			}
			else if(magnitude>=4 && magnitude<6){
				color = 'orange';
			}
			else if(magnitude>=6 && magnitude<8){
				color = 'red';
			}
			else{
				color = 'darkred';
			}
			return color;
		}


		var mymap = L.map('mapid').setView([2.505, -0.09], 2);

		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
				'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery  <a href="https://www.mapbox.com/">Mapbox</a>',
			id: 'mapbox.streets'
		}).addTo(mymap);

		{% for event in listseismes %}
			var marker = L.marker([{{event.latitude}},{{event.longitude}}], {
				icon: new L.Icon.Default(),
			}).addTo(mymap);


			var icon = L.AwesomeMarkers.icon({
				icon: 'exclamation-triangle',
				iconColor: 'white',
				markerColor: color_marker({{event.magnitude}}),
				prefix : 'fa',
				extraClasses: 'fa-rotate-0'
			});

			marker.setIcon(icon);
			marker.bindTooltip("Click to see earthquake");
			var index = {{loop.index}};
			var len = {{loop.length}};
			if(index == len){
				marker.bindTooltip("Click to see earthquake").openTooltip();
			}
			marker.bindPopup("<b>{{event.location}}</b><br /> " +
				"Magnitude : {{event.magnitude}}<br />" +
				"Time : {{event.time}} (UTC)<br />" +
				"Depth : {{event.depth}} kilometers<br />" +
				"<a target=_blank rel=noopener noreferrer href={{event.url}}>Click for more info</a>");     
		{% endfor %}
						
	</script>
</html>
